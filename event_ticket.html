{% extends "base.html" %}

{% block title %} Event Details {% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center">活動資訊</h1>

    <div class="event-block" style="background-color: black; color: white; border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);">
        <h2 class="event-title">Title</h2>
        <p class="event-description">{{ event.title }}</p>
        <img src="{{ url_for('get_event_image', event_id=event._id) }}" alt="Event Image" style="width: 1000px; height: 562px; margin: 0 auto; display: block;"/>
    </div>


    <div class="event-block" style="background: linear-gradient(to bottom, #ffffff, #ffffff); padding: 20px; border: 1px solid #c7d2ff; border-radius: 10px;">
        <h2 class="event-title">Other Details</h2>
        <p class="event-description"><strong>Time:</strong> {{ event.time }}</p>
        <p class="event-description"><strong>Ticket Time:</strong> {{ event.ticket_time }}</p>

        <!-- 使用下拉选择框 -->
        <label><strong>Ticket Price:</strong></label><br>
        {% for ticket in event.ticket %}
            <input type="radio" id="price{{ loop.index }}" name="ticketPrice" value="{{ ticket.price }}">
            <label for="price{{ loop.index }}">{{ ticket.name }} - ${{ ticket.price }}</label><br>
        {% endfor %}

        <p class="event-description"><strong>Ticket Amount:</strong> {{ event.ticket_amount }}</p>

        <!-- 添加购买按钮 -->
        <button onclick="redirectToCheckout()">購買</button>
    </div>
</div>
<!-- 在模板中的JavaScript部分 -->
<script>
function redirectToCheckout() {
    // 获取选定的票价值
    var selectedPrice, selectedName;
    var priceOptions = document.getElementsByName('ticketPrice');
    for (var i = 0; i < priceOptions.length; i++) {
        if (priceOptions[i].checked) {
            selectedPrice = priceOptions[i].value;
            selectedName = priceOptions[i].nextElementSibling.textContent.split(' - ')[0].trim();
            break;
        }
    }

    // 获取事件的 ID
    var eventId = '{{ event._id }}'; // 将 Python 变量 event._id 的值传递到 JavaScript

    // 如果没有选择票价，则不进行跳转
    if (!selectedPrice) {
        alert('请先选择票价！');
        return;
    }

    var encodedName = encodeURI(selectedName);

    // 跳转到购买页面，并将数据作为查询参数传递
    var ticketAmount = 1; // 默认为1，你可以根据需要进行更改
    window.location.href = '/' + eventId + '/checkout?price=' + selectedPrice + '&name=' + encodedName + '&amount=' + ticketAmount;
}
</script>

{% endblock %}
